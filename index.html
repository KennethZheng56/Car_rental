<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Car Rental Login</title>
  <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { margin-bottom: 20px; }
    input { padding: 5px; margin-bottom: 10px; display: block; }
    button { padding: 5px 10px; margin-bottom: 10px; }
    .msg { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>Car Rental Login</h1>

  <div id="login-section">
    <h2>Login</h2>
    <input id="loginUser" type="text" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginMsg" class="msg"></p>
  </div>

  <div id="signup-section">
    <h2>Sign Up</h2>
    <input id="signupUser" type="text" placeholder="Username">
    <input id="signupPass" type="password" placeholder="Password">
    <button onclick="signup()">Sign Up</button>
    <p id="signupMsg" class="msg"></p>
  </div>

  <script type="py-script" src="Temp_database.py"></script>

  <py-script>
from js import document, localStorage, window
import json

def setSession(user):
    localStorage.setItem("SESSION", json.dumps(user))

def login(ev=None):
    username = document.getElementById("loginUser").value
    password = document.getElementById("loginPass").value
    msg = document.getElementById("loginMsg")
    msg.innerHTML = ""

    user = verify_user(username, password)
    if user:
        setSession(user)
        if user["role"] == "admin":
            window.location.href = "admin.html"
        else:
            window.location.href = "app.html"
    else:
        msg.innerHTML = "Invalid username or password!"

def signup(ev=None):
    username = document.getElementById("signupUser").value
    password = document.getElementById("signupPass").value
    msg = document.getElementById("signupMsg")
    msg.innerHTML = ""

    if not username or not password:
        msg.innerHTML = "Please fill in all fields."
        return

    if add_user(username, password):
        msg.innerHTML = "Account created successfully!"
        msg.className = "success"
    else:
        msg.innerHTML = "Username already exists!"
        msg.className = "msg"

def check_session():
    session_json = localStorage.getItem("SESSION")
    if session_json:
        user = json.loads(session_json)
        if user["role"] == "admin":
            window.location.href = "admin.html"
        else:
            window.location.href = "app.html"

check_session()
  </py-script>
</body>
</html>
