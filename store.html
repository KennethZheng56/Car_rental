<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Car Rental Pro â€” Store</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,Arial;background:#f5f7fa}
  header{background:#2c3e50;color:#fff;padding:16px 24px;display:flex;align-items:center;justify-content:space-between}
  h1{margin:0;font-size:20px}
  nav{display:flex;gap:12px;align-items:center}
  nav a, nav span{color:#fff;text-decoration:none;font-weight:600}
  .wrap{max-width:1200px;margin:18px auto;padding:0 18px}
  .filters{display:flex;gap:12px;margin-bottom:14px;align-items:center;flex-wrap:wrap}
  select,input[type="date"]{padding:8px;border-radius:6px;border:1px solid #ccc;background:#fff}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
  .card{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(20,30,50,0.06);overflow:hidden;display:flex;flex-direction:column}
  .thumb{height:160px;background:#efefef;display:block;width:100%;object-fit:cover}
  .body{padding:14px;flex:1;display:flex;flex-direction:column}
  .body h3{margin:0 0 6px;color:#203445}
  .meta{color:#6b7785;font-size:13px;margin-bottom:8px}
  .price{font-weight:700;color:#1f8f4a;margin-top:auto}
  .row{display:flex;gap:8px;align-items:center;margin-top:12px}
  .btn{padding:10px 12px;border-radius:8px;border:none;background:#1161ee;color:#fff;cursor:pointer;font-weight:700}
  .btn[disabled]{background:#bdbdbd;cursor:not-allowed}
  .muted{color:#6b7785;font-size:13px}
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px}
  .modal{background:#fff;border-radius:12px;padding:18px;max-width:520px;width:100%;box-shadow:0 14px 40px rgba(10,20,40,0.2)}
  .form-row{display:flex;gap:10px}
  .small{flex:1}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  .booked-note{color:#b23;font-weight:700}
</style>
</head>
<body>
<header>
  <h1>Car Rental Store</h1>
  <nav>
    <span id="welcomeUser">Guest</span>
    <a href="#" id="adminLink">Admin</a>
    <a id="logoutBtn" href="#">Logout</a>
  </nav>
</header>

<div class="wrap">
  <div class="filters">
    <select id="categoryFilter"><option value="">All Categories</option><option>Sedan</option><option>SUV</option><option>Economy</option><option>Luxury</option></select>
    <select id="transFilter"><option value="">Any Transmission</option><option>Automatic</option><option>Manual</option></select>
    <select id="priceFilter"><option value="">Any Price</option><option value="1">Below $50</option><option value="2">$50-100</option><option value="3">Above $100</option></select>
    <input id="fromDate" type="date">
    <input id="toDate" type="date">
    <button class="btn" id="applyDateBtn">Check Availability</button>
  </div>

  <div id="grid" class="grid"></div>

  <h3 style="margin-top:22px">Your Bookings</h3>
  <table id="bookingsTable"><thead><tr><th>Car</th><th>Period</th><th>Status</th><th>Action</th></tr></thead><tbody></tbody></table>
</div>

<div id="payModal" class="modal-back">
  <div class="modal">
    <h3 id="payTitle">Book car</h3>
    <div id="payDetails" style="margin-bottom:12px;color:#333"></div>
    <form id="payForm">
      <div style="margin-bottom:8px"><label class="muted">Name on Card</label><input required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc" id="cardName"></div>
      <div style="margin-bottom:8px"><label class="muted">Card Number</label><input required maxlength="19" placeholder="1234 5678 9012 3456" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc" id="cardNum"></div>
      <div class="form-row">
        <input id="exp" placeholder="MM/YY" class="small" required style="padding:8px;border-radius:6px;border:1px solid #ccc">
        <input id="cvv" placeholder="CVV" class="small" required maxlength="4" style="padding:8px;border-radius:6px;border:1px solid #ccc">
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button type="button" class="btn" id="cancelPay" style="background:#bdbdbd">Cancel</button>
        <button type="submit" class="btn">Pay & Confirm</button>
      </div>
    </form>
  </div>
</div>

<script>
  function getCars(){try{return JSON.parse(localStorage.getItem('CARS'))||[];}catch(e){localStorage.setItem('CARS','[]');return[]}}
  function saveCars(v){localStorage.setItem('CARS',JSON.stringify(v))}
  function getBookings(){try{return JSON.parse(localStorage.getItem('BOOKINGS'))||[];}catch(e){localStorage.setItem('BOOKINGS','[]');return[]}}
  function saveBookings(v){localStorage.setItem('BOOKINGS',JSON.stringify(v))}

  (function initBase(){
    const cars = getCars()
    if(cars.length===0){
      const base = [
        {make:"Toyota",model:"Corolla",year:2020,transmission:"Automatic",seats:5,price:50,category:"Sedan",image:"https://www.edmunds.com/assets/m/toyota/corolla-hatchback/2020/oem/2020_toyota_corolla-hatchback_4dr-hatchback_nightshade-edition_fq_oem_1_815.jpg",booked:false},
        {make:"Honda",model:"Civic",year:2021,transmission:"Automatic",seats:5,price:55,category:"Sedan",image:"https://www.iihs.org/cdn-cgi/image/width=636/api/ratings/model-year-images/3003/",booked:false},
        {make:"Nissan",model:"Altima",year:2019,transmission:"Automatic",seats:5,price:52,category:"Sedan",image:"https://images.hgmsites.net/hug/2019-nissan-altima_100672352_h.jpg",booked:false},
        {make:"Honda",model:"CR-V",year:2019,transmission:"Automatic",seats:5,price:65,category:"SUV",image:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/13/2019_Honda_CR-V_1.5_Turbo_Prestige_RW1_%2820210821%29.jpg/640px-2019_Honda_CR-V_1.5_Turbo_Prestige_RW1_%2820210821%29.jpg",booked:false},
        {make:"Toyota",model:"RAV4",year:2020,transmission:"Automatic",seats:5,price:68,category:"SUV",image:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/2021_Toyota_RAV4_Prime_au_SIAM_2020.jpg/640px-2021_Toyota_RAV4_Prime_au_SIAM_2020.jpg",booked:false},
        {make:"Ford",model:"Explorer",year:2018,transmission:"Automatic",seats:7,price:75,category:"SUV",image:"https://images.jazelc.com/uploads/galpinford-m2en/2018_Ford_Explorer_XLT-1024x567-1.png",booked:false},
        {make:"Hyundai",model:"Accent",year:2020,transmission:"Automatic",seats:5,price:35,category:"Economy",image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/2018_Hyundai_Accent_au_SIAM_de_2018.jpg/640px-2018_Hyundai_Accent_au_SIAM_de_2018.jpg",booked:false},
        {make:"Kia",model:"Rio",year:2019,transmission:"Automatic",seats:5,price:33,category:"Economy",image:"https://cdn-ds.com/blogs-media/sites/167/2019/10/15133524/2019_Kia_Rio_A149_o.jpg",booked:false},
        {make:"Chevrolet",model:"Spark",year:2018,transmission:"Automatic",seats:4,price:30,category:"Economy",image:"https://images.hgmsites.net/hug/2018-chevrolet-spark_100636242_h.jpg",booked:false},
        {make:"Ford",model:"Mustang",year:2018,transmission:"Manual",seats:4,price:120,category:"Luxury",image:"https://hips.hearstapps.com/hmg-prod/images/new-ford-mustang-v8-gt-with-performace-pack-in-orange-fury-1-1500912917.jpg?crop=0.6666666666666666xw:1xh;center,top&resize=1200:*",booked:false},
        {make:"BMW",model:"5 Series",year:2020,transmission:"Automatic",seats:5,price:150,category:"Luxury",image:"data:image/jpeg;base64,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",booked:false},
        {make:"Mercedes-Benz",model:"E-Class",year:2021,transmission:"Automatic",seats:5,price:160,category:"Luxury",image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRVx3DiFw_JdZ4ZzTEKTWkkhr1s6uPuQL11SA&s",booked:false},
        {make:"Chevrolet", model:"Corvette C6", year:2006,transmission:"Automatic",seats:5,price:200,category:"Luxury",images:"https://m.media-amazon.com/images/M/MV5BZDNhODAwMTUtZDIxMi00YThmLWE4ODMtNzFmZjAyMzM5NmM3XkEyXkFqcGc@._V1_.jpg",booked:false},

      ]
      saveCars(base)
    }
  })()

  const current = JSON.parse(localStorage.getItem('CURRENT_USER')||'null')
  const welcome = document.getElementById('welcomeUser')
  if(current) welcome.textContent = 'Hi, '+current.username
  else welcome.textContent = 'Guest'

  document.getElementById('logoutBtn').addEventListener('click',e=>{
    e.preventDefault()
    localStorage.removeItem('CURRENT_USER')
    window.location.href='index.html'
  })

  document.getElementById('adminLink').addEventListener('click', e => {
    e.preventDefault();
    const pass = prompt("Enter Admin Password:");
    if (pass === "CIS453") {
      window.location.href = "admin.html";
    } else if (pass !== null) {
      alert("Incorrect password!");
    }
  });

  const grid = document.getElementById('grid')
  const catF = document.getElementById('categoryFilter'), transF = document.getElementById('transFilter'), priceF = document.getElementById('priceFilter')
  const fromD = document.getElementById('fromDate'), toD = document.getElementById('toDate'), applyDateBtn = document.getElementById('applyDateBtn')
  const payModal = document.getElementById('payModal'), payForm = document.getElementById('payForm'), payTitle = document.getElementById('payTitle'), payDetails = document.getElementById('payDetails')
  let toBook = null
  const bookingsTbody = document.querySelector('#bookingsTable tbody')

  function isOverlapping(bookings, carIndex, start, end){
    return bookings.some(b=>{
      if(b.carIndex!==carIndex) return false
      const s=new Date(b.from), e=new Date(b.to)
      return !(end <= s || start >= e)
    })
  }

  function renderGrid(){
    grid.innerHTML=''
    const cars = getCars()
    const category = catF.value, trans = transF.value, price = priceF.value
    cars.forEach((c,i)=>{
      if(category && c.category!==category) return
      if(trans && c.transmission!==trans) return
      if(price==='1' && c.price>=50) return
      if(price==='2' && (c.price<50||c.price>100)) return
      if(price==='3' && c.price<=100) return
      const tile = document.createElement('div'); tile.className='card'
      tile.innerHTML = `<img class="thumb" src="${c.image||'https://picsum.photos/seed/'+i+'/600/400'}" alt="">
        <div class="body">
          <h3>${c.make} ${c.model}</h3>
          <div class="meta">${c.year} â€¢ ${c.transmission} â€¢ ${c.seats} seats</div>
          <div class="price">$${c.price}/day</div>
          <div class="row">
            <button class="btn" id="rent_${i}">${c.booked ? 'Booked' : 'Rent Now'}</button>
            <div style="flex:1"></div>
            ${c.booked?'<div class="muted booked-note">Unavailable</div>':''}
          </div>
        </div>`
      grid.appendChild(tile)
      const btn = document.getElementById('rent_'+i)
      btn.disabled = !!c.booked
      btn.addEventListener('click',()=>openBooking(i))
    })
    renderBookings()
  }

  function openBooking(index){
    const cars = getCars()
    toBook = index
    payTitle.textContent = `Pay to book ${cars[index].make} ${cars[index].model}`
    payDetails.textContent = `Price: $${cars[index].price}/day. Choose dates above and press Check Availability first.`
    payModal.style.display='flex'
  }

  document.getElementById('cancelPay').addEventListener('click',()=>{payModal.style.display='none';toBook=null})
  payForm && payForm.addEventListener('submit',function(e){
    e.preventDefault()
    if(!toBook){alert('No car selected');return}
    const from = document.getElementById('fromDate').value, to = document.getElementById('toDate').value
    if(!from||!to){alert('Select from and to dates first');return}
    const s=new Date(from), t=new Date(to)
    if(s>=t){alert('End date must be after start');return}
    const bookings = getBookings()
    if(isOverlapping(bookings,toBook,s,t)){alert('Car already booked for this period');return}
    const booking = {id:Date.now(),carIndex:toBook,from:from,to:to,user:(current?current.username:'Guest'),status:'Confirmed',created:new Date().toISOString()}
    bookings.push(booking)
    saveBookings(bookings)
    const cars = getCars(); cars[toBook].booked = true; saveCars(cars)
    payModal.style.display='none'
    payForm.reset()
    toBook = null
    renderGrid()
    alert('Payment successful â€” booking confirmed.')
  })

  applyDateBtn.addEventListener('click',()=>{
    const from = fromD.value, to = toD.value
    if(!from||!to){alert('Pick from and to dates'); return}
    const s=new Date(from), t=new Date(to)
    if(s>=t){alert('End date must be after start');return}
    const bookings = getBookings()
    const cars = getCars()
    cars.forEach((c,i)=> c.booked = isOverlapping(bookings,i,s,t) ? true : c.booked)
    saveCars(cars)
    renderGrid()
  })

  function renderBookings(){
    const bookings = getBookings()
    const cars = getCars()
    bookingsTbody.innerHTML=''
    bookings.forEach((b,idx)=>{
      const row = document.createElement('tr')
      row.innerHTML = `<td>${cars[b.carIndex].make} ${cars[b.carIndex].model}</td><td>${b.from} â†’ ${b.to}</td><td>${b.status}</td>
        <td><button class="btn" id="cancel_${idx}">Cancel</button></td>`
      bookingsTbody.appendChild(row)
      document.getElementById('cancel_'+idx).addEventListener('click',()=>{
        if(!confirm('Cancel this booking?')) return
        const arr = getBookings(); const rem = arr.splice(idx,1); saveBookings(arr)
        const carIdx = rem[0].carIndex
        const remaining = arr.some(x=>x.carIndex===carIdx)
        const cars = getCars()
        if(!remaining) cars[carIdx].booked = false
        saveCars(cars)
        renderGrid()
      })
    })
  }

  renderGrid()
</script>
</body>
</html>
