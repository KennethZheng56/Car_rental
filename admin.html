<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Car Rental Pro — Admin</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,Arial;background:#f5f7fa;display:flex;min-height:100vh}
  .sidebar{width:240px;background:#2c3e50;color:#fff;padding:24px}
  .sidebar h2{margin:0 0 18px;font-size:18px}
  .sidebar a{color:#fff;display:block;text-decoration:none;padding:8px 10px;border-radius:8px;margin-bottom:8px;background:transparent}
  .main{flex:1;padding:22px}
  form{background:#fff;padding:16px;border-radius:12px;box-shadow:0 8px 20px rgba(20,30,50,0.06);max-width:720px;margin-bottom:20px}
  input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;margin-bottom:10px}
  button{padding:8px 12px;border-radius:8px;border:none;background:#1161ee;color:#fff;cursor:pointer;font-weight:700}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 8px 18px rgba(20,30,50,0.05)}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
  img{max-width:100px;border-radius:6px}
  .btn{padding:6px 8px;border-radius:6px;border:none;cursor:pointer}
  .edit{background:#3498db;color:#fff}
  .del{background:#e73c3c;color:#fff}
  .toggle{background:#777;color:#fff}
</style>
</head>
<body>
  <div class="sidebar">
    <h2>Admin Panel</h2>
    <a href="store.html">Store</a>
    <a href="index.html" onclick="localStorage.removeItem('CURRENT_USER')">Logout</a>
  </div>

  <div class="main">
    <h1>Manage Cars & Bookings</h1>

    <form id="carForm">
      <input type="hidden" id="editIndex">
      <input id="make" placeholder="Make" required>
      <input id="model" placeholder="Model" required>
      <input type="number" id="year" placeholder="Year" required>
      <select id="transmission"><option value="">Transmission</option><option>Automatic</option><option>Manual</option></select>
      <input type="number" id="seats" placeholder="Seats" required>
      <input type="number" id="price" placeholder="Price per day ($)" required>
      <select id="category"><option value="">Category</option><option>Sedan</option><option>SUV</option><option>Economy</option><option>Luxury</option></select>
      <input id="image" placeholder="Image URL (optional)">
      <div style="display:flex;gap:8px">
        <button type="submit">Save Car</button>
        <button type="button" id="resetBtn" style="background:#9aa; color:#fff">Reset</button>
      </div>
    </form>

    <h3>Cars</h3>
    <table id="carTable">
      <thead><tr><th>Make</th><th>Model</th><th>Year</th><th>Trans</th><th>Seats</th><th>Price</th><th>Category</th><th>Image</th><th>Booked</th><th>Actions</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3 style="margin-top:18px">Bookings</h3>
    <table id="bookTable">
      <thead><tr><th>Car</th><th>Period</th><th>User</th><th>Status</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  function getCars(){try{return JSON.parse(localStorage.getItem('CARS'))||[];}catch(e){localStorage.setItem('CARS','[]');return[]}}
  function saveCars(v){localStorage.setItem('CARS',JSON.stringify(v))}
  function getBookings(){try{return JSON.parse(localStorage.getItem('BOOKINGS'))||[];}catch(e){localStorage.setItem('BOOKINGS','[]');return[]}}
  function saveBookings(v){localStorage.setItem('BOOKINGS',JSON.stringify(v))}

  const form = document.getElementById('carForm'), tbody = document.querySelector('#carTable tbody'), bookT = document.querySelector('#bookTable tbody')
  const resetBtn = document.getElementById('resetBtn')

  function renderCars(){
    const cars = getCars(); tbody.innerHTML=''
    cars.forEach((c,i)=>{
      const tr = document.createElement('tr')
      tr.innerHTML = `<td>${c.make}</td><td>${c.model}</td><td>${c.year}</td><td>${c.transmission}</td><td>${c.seats}</td><td>$${c.price}</td><td>${c.category}</td>
        <td>${c.image?'<img src="'+c.image+'" alt="">':'No image'}</td>
        <td>${c.booked? 'Yes':'No'}</td>
        <td>
          <button class="btn edit" data-i="${i}">Edit</button>
          <button class="btn del" data-i="${i}">Delete</button>
          <button class="btn toggle" data-i="${i}">${c.booked? 'Unbook':'Book'}</button>
        </td>`
      tbody.appendChild(tr)
    })
    attachCarEvents()
  }

  function renderBookings(){
    const bookings = getBookings(); const cars = getCars(); bookT.innerHTML=''
    bookings.forEach((b,idx)=>{
      const tr = document.createElement('tr')
      tr.innerHTML = `<td>${cars[b.carIndex].make} ${cars[b.carIndex].model}</td><td>${b.from} → ${b.to}</td><td>${b.user}</td><td>${b.status}</td>
        <td><button class="btn delBooking" data-i="${idx}">Delete</button></td>`
      bookT.appendChild(tr)
    })
    Array.from(document.getElementsByClassName('delBooking')).forEach(btn=>{
      btn.onclick = ()=>{ const i=+btn.dataset.i; if(confirm('Remove booking?')){ const arr=getBookings(); const rem=arr.splice(i,1)[0]; saveBookings(arr); // free car if no other bookings
        const remaining = arr.some(x=>x.carIndex===rem.carIndex); if(!remaining){const cars=getCars();cars[rem.carIndex].booked=false;saveCars(cars)} renderCars(); renderBookings(); } }
    })
  }

  function attachCarEvents(){
    Array.from(document.getElementsByClassName('edit')).forEach(b=>{
      b.onclick = ()=>{ const i=+b.dataset.i; const c=getCars()[i]; document.getElementById('editIndex').value=i; document.getElementById('make').value=c.make; document.getElementById('model').value=c.model; document.getElementById('year').value=c.year; document.getElementById('transmission').value=c.transmission; document.getElementById('seats').value=c.seats; document.getElementById('price').value=c.price; document.getElementById('category').value=c.category; document.getElementById('image').value=c.image||'' }
    })
    Array.from(document.getElementsByClassName('del')).forEach(b=>{
      b.onclick = ()=>{ const i=+b.dataset.i; if(confirm('Delete car?')){ const arr=getCars(); arr.splice(i,1); saveCars(arr); renderCars(); } }
    })
    Array.from(document.getElementsByClassName('toggle')).forEach(b=>{
      b.onclick = ()=>{ const i=+b.dataset.i; const cars=getCars(); cars[i].booked = !cars[i].booked; saveCars(cars); renderCars() }
    })
  }

  form.addEventListener('submit',e=>{
    e.preventDefault()
    const idx = document.getElementById('editIndex').value
    const car = { make:document.getElementById('make').value.trim(), model:document.getElementById('model').value.trim(), year:+document.getElementById('year').value, transmission:document.getElementById('transmission').value, seats:+document.getElementById('seats').value, price:+document.getElementById('price').value, category:document.getElementById('category').value, image:document.getElementById('image').value, booked:false}
    const cars = getCars()
    if(idx===''){ cars.push(car) } else { cars[idx]=car; document.getElementById('editIndex').value='' }
    saveCars(cars); form.reset(); renderCars()
  })

  resetBtn.addEventListener('click',()=>{ form.reset(); document.getElementById('editIndex').value=''; })

  renderCars()
  renderBookings()
</script>
</body>
</html>
